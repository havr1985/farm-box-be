@startuml GroceryFlow-ERD-Full
' GroceryFlow - Full ERD (Course Schema)
' Will be implemented incrementally

hide circle
skinparam linetype ortho
skinparam shadowing false
skinparam backgroundColor #FEFEFE

skinparam entity {
  BackgroundColor #2D2D2D
  BorderColor #2D2D2D
  FontColor #FFFFFF
}

' ==========================================
' PHASE 1 - HW5 (Current)
' ==========================================

entity "users" as users {
  * id : uuid <<PK>>
  --
  * email : varchar(255) <<UNIQUE>>
  * password_hash : varchar(255)
  * name : varchar(255)
  * role : varchar(50)
  --
  * created_at : timestamptz
  * updated_at : timestamptz
}

entity "products" as products {
  * id : uuid <<PK>>
  --
  * sku : varchar(100) <<UNIQUE>>
  * name : varchar(255)
  * description : text
  * price : numeric(12,2)
  * stock : int
  * is_active : boolean
  --
  * created_at : timestamptz
  * updated_at : timestamptz
}

entity "orders" as orders {
  * id : uuid <<PK>>
  --
  * user_id : uuid <<FK>>
  * idempotency_key : uuid
  * status : varchar(50)
  * total_amount : numeric(12,2)
  --
  * created_at : timestamptz
  * updated_at : timestamptz
}

entity "order_items" as order_items {
  * id : uuid <<PK>>
  --
  * order_id : uuid <<FK>>
  * product_id : uuid <<FK>>
  * product_name : varchar(255)
  * qty : int
  * unit_price : numeric(12,2)
  * line_total : numeric(12,2)
}

' ==========================================
' PHASE 2 - Categories & Cart
' ==========================================

entity "categories" as categories #444444 {
  * id : uuid <<PK>>
  --
  * name : varchar(255)
  * slug : varchar(255) <<UNIQUE>>
  * parent_id : uuid <<FK>>
}

entity "product_categories" as product_categories #444444 {
  * product_id : uuid <<PK,FK>>
  * category_id : uuid <<PK,FK>>
}

entity "carts" as carts #444444 {
  * id : uuid <<PK>>
  --
  * user_id : uuid <<FK>>
  * is_active : boolean
  --
  * created_at : timestamptz
  * updated_at : timestamptz
}

entity "cart_items" as cart_items #444444 {
  * id : uuid <<PK>>
  --
  * cart_id : uuid <<FK>>
  * product_id : uuid <<FK>>
  * qty : int
}

' ==========================================
' PHASE 3 - Payments & Shipments
' ==========================================

entity "payments" as payments #555555 {
  * id : uuid <<PK>>
  --
  * order_id : uuid <<FK>>
  * provider : varchar(50)
  * status : varchar(50)
  * amount : numeric(12,2)
  * external_id : varchar(255)
  --
  * created_at : timestamptz
}

entity "shipments" as shipments #555555 {
  * id : uuid <<PK>>
  --
  * order_id : uuid <<FK>>
  * user_id : uuid <<FK>>
  * status : varchar(50)
  * tracking_number : varchar(255)
  * address : jsonb
  --
  * created_at : timestamptz
  * updated_at : timestamptz
}

' ==========================================
' PHASE 4 - Wishlist
' ==========================================

entity "wishlists" as wishlists #666666 {
  * id : uuid <<PK>>
  --
  * user_id : uuid <<FK>>
  * product_id : uuid <<FK>>
  --
  * created_at : timestamptz
}

' ==========================================
' Relationships
' ==========================================

' Phase 1
users ||--o{ orders : "places"
orders ||--|{ order_items : "contains"
products ||--o{ order_items : "in"

' Phase 2
categories ||--o{ categories : "parent"
products ||--o{ product_categories : "tagged"
categories ||--o{ product_categories : "contains"
users ||--o| carts : "has"
carts ||--o{ cart_items : "contains"
products ||--o{ cart_items : "in"

' Phase 3
orders ||--o{ payments : "paid by"
orders ||--o| shipments : "shipped"
users ||--o{ shipments : "receives"

' Phase 4
users ||--o{ wishlists : "wants"
products ||--o{ wishlists : "wished"

@enduml
